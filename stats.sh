#!/usr/bin/env fish

set RUNS_CNT 0x100

#set EXPLOIT_PATH "poc.js"
set EXPLOIT_PATH "stage_ctrl/trigger.js"
#set EXPLOIT_PATH "stage_one/trigger.js"

#set D8_PATH "../v8/out/x64.debug/d8"
set D8_PATH "../v8/out/x64.release/d8"

set l_suc_cnt 0

for i in (seq $RUNS_CNT);
	echo "Trying... $l_suc_cnt / $i /" (math $RUNS_CNT)
	$D8_PATH --allow-natives-syntax --expose-gc $EXPLOIT_PATH
	if test $status != 0;
		set l_suc_cnt (math $l_suc_cnt + 1);
	else;
		sleep 1
		exit
	end;
end;

set suc_rate (math $l_suc_cnt "*" 100 / $RUNS_CNT)
echo "Success Rate: $suc_rate%" 
